# MentorAI Discord Bot - Complete Technical Documentation
## Full System Overview for DeepSeek AI Analysis

**Version:** 2.0.0  
**Last Updated:** January 2025  
**Purpose:** Comprehensive documentation of the MentorAI Discord learning bot for DeepSeek AI to fully understand the system before analyzing logic errors

---

# TABLE OF CONTENTS

1. [WHAT IS MENTORAI](#1-what-is-mentorai)
2. [CORE TECHNOLOGY STACK](#2-core-technology-stack)
3. [ARCHITECTURE OVERVIEW](#3-architecture-overview)
4. [DATABASE SCHEMA](#4-database-schema)
5. [ALL 50 SLASH COMMANDS](#5-all-50-slash-commands)
6. [GAMIFICATION SYSTEM](#6-gamification-system)
7. [AI INTEGRATION](#7-ai-integration)
8. [XP & LEVELING SYSTEM](#8-xp--leveling-system)
9. [STREAK SYSTEM](#9-streak-system)
10. [PRESTIGE SYSTEM](#10-prestige-system)
11. [ACHIEVEMENT SYSTEM](#11-achievement-system)
12. [QUIZ SYSTEM](#12-quiz-system)
13. [LEARNING SYSTEM](#13-learning-system)
14. [WEB INTERFACE](#14-web-interface)
15. [DATA FLOW DIAGRAMS](#15-data-flow-diagrams)
16. [KEY FILE LOCATIONS](#16-key-file-locations)

---

# 1. WHAT IS MENTORAI

## Mission Statement
MentorAI is an AI-powered Discord bot that makes learning programming fun through gamification. It combines interactive AI-generated lessons, quizzes, and a comprehensive reward system to motivate users to learn consistently.

## Target Users
- Programming beginners looking to learn coding
- Students preparing for technical interviews
- Developers wanting to reinforce knowledge
- Anyone who wants to learn through gamified experience

## Core Value Propositions
1. **AI-Generated Content** - Every lesson and quiz is dynamically generated by AI
2. **Gamification** - XP, levels, achievements, streaks, and leaderboards
3. **Personalization** - Content adapts to user's skill level and weak areas
4. **Social Learning** - Leaderboards, team battles, study parties
5. **Accessibility** - Free to use on Discord, no additional apps needed

## Bot Identity
- **Name:** MentorAI
- **Tagline:** "Your AI-powered learning companion"
- **Primary Color:** #5865F2 (Discord Blurple)
- **Mascot Emoji:** ðŸŽ“

---

# 2. CORE TECHNOLOGY STACK

## Runtime & Framework
```
Node.js v18+       - JavaScript runtime
Discord.js v14.18  - Discord API wrapper
Express.js v4.18   - Web server for admin panel and API
```

## Database
```
MongoDB            - Primary database
Mongoose v8.15     - MongoDB ODM (Object Document Mapper)
```

## AI Providers (Priority Order)
```
1. Google Gemini Flash 2.0  - Fast quiz generation (when GEMINI_API_KEY set)
2. OpenAI GPT-4o            - Primary AI for lessons and complex quizzes
3. OpenAI GPT-4o-mini       - Fallback for simple generation
4. OpenAI o1                - Advanced reasoning for quiz questions
5. Anthropic Claude         - Fallback when OpenAI unavailable
```

## Additional Dependencies
```
@napi-rs/canvas    - Image generation for trading cards
socket.io          - Real-time admin panel updates
jsonwebtoken       - Admin authentication
bcryptjs           - Password hashing
dotenv             - Environment configuration
```

## Deployment
```
Platform: Railway.app
URL: https://mentorai.up.railway.app
Container: Docker
```

---

# 3. ARCHITECTURE OVERVIEW

## Directory Structure
```
src/
â”œâ”€â”€ index.js                    # Bot entry point
â”œâ”€â”€ deploy-commands.js          # Discord command registration
â”œâ”€â”€ ai/                         # AI integration layer
â”‚   â”œâ”€â”€ index.js               # Main AI orchestrator
â”‚   â”œâ”€â”€ openai.js              # OpenAI-specific functions
â”‚   â”œâ”€â”€ gemini.js              # Google Gemini integration
â”‚   â”œâ”€â”€ anthropic.js           # Claude fallback
â”‚   â””â”€â”€ tutorAI.js             # Tutor chat functionality
â”œâ”€â”€ bot/
â”‚   â”œâ”€â”€ commandLoader.js       # Loads all slash commands
â”‚   â”œâ”€â”€ eventLoader.js         # Loads Discord event handlers
â”‚   â”œâ”€â”€ commands/              # 50 slash commands
â”‚   â”œâ”€â”€ events/                # Discord event handlers
â”‚   â””â”€â”€ handlers/              # Interaction handlers
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ brandSystem.js         # UI/UX constants, colors, XP formulas
â”‚   â”œâ”€â”€ colors.js              # Color definitions
â”‚   â”œâ”€â”€ designSystem.js        # Embed builders
â”‚   â”œâ”€â”€ quizConfig.js          # Quiz settings
â”‚   â”œâ”€â”€ achievements.js        # Achievement definitions
â”‚   â”œâ”€â”€ helpConfig.js          # Help system config
â”‚   â””â”€â”€ subjects.js            # Topic categories
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ connection.js          # MongoDB connection
â”‚   â””â”€â”€ models/
â”‚       â”œâ”€â”€ User.js            # User schema (main)
â”‚       â”œâ”€â”€ QuizSession.js     # Quiz session storage
â”‚       â””â”€â”€ ServerSettings.js  # Per-server config
â”œâ”€â”€ services/                   # Business logic layer
â”‚   â”œâ”€â”€ gamificationService.js # XP, achievements, streaks
â”‚   â”œâ”€â”€ quizService.js         # Quiz session management
â”‚   â”œâ”€â”€ learningService.js     # Lesson generation
â”‚   â”œâ”€â”€ adminService.js        # Admin functions
â”‚   â””â”€â”€ ...                    # Other services
â”œâ”€â”€ utils/                      # Utility functions
â”‚   â”œâ”€â”€ embedBuilder.js        # Discord embed helpers
â”‚   â”œâ”€â”€ quizUtils.js           # Quiz utilities
â”‚   â”œâ”€â”€ animations.js          # Loading animations
â”‚   â””â”€â”€ mobileUI.js            # Mobile-optimized UI
â”œâ”€â”€ web/                        # Admin panel & API
â”‚   â”œâ”€â”€ server.js              # Express server
â”‚   â”œâ”€â”€ routes/                # API routes
â”‚   â”œâ”€â”€ middleware/            # Auth middleware
â”‚   â””â”€â”€ public/                # Admin panel static files
â””â”€â”€ data/
    â””â”€â”€ quizzes/               # Curated fallback questions
```

## Request Flow
```
User sends /command
         â†“
Discord Gateway â†’ interactionCreate.js
         â†“
Command Router â†’ src/bot/commands/{command}.js
         â†“
Service Layer â†’ src/services/{service}Service.js
         â†“
[AI Layer] â†’ src/ai/index.js â†’ OpenAI/Gemini/Claude
         â†“
[Database] â†’ MongoDB via Mongoose
         â†“
Response Builder â†’ config/designSystem.js
         â†“
Discord Embed â†’ User sees response
```

---

# 4. DATABASE SCHEMA

## User Model (src/database/models/User.js)

This is the PRIMARY data model. All user data lives here.

### Core Fields
```javascript
{
  discordId: String,           // Discord user ID (unique identifier)
  username: String,            // Discord username
  xp: Number,                  // XP within current level (0 to xpForNextLevel-1)
  level: Number,               // Current level (starts at 1)
  streak: Number,              // Activity streak in days
  lastActive: Date,            // Last interaction timestamp
}
```

### Daily Bonus Fields
```javascript
{
  lastDailyBonus: Date,        // When daily bonus was last claimed
  dailyBonusStreak: Number,    // Separate streak for daily bonus
  timezone: String,            // User timezone (default: 'UTC')
}
```

### Learning Progress
```javascript
{
  achievements: [String],      // Array of achievement names earned
  completedLessons: [String],  // Array of completed lesson IDs
  topicsStudied: [String],     // Topics user has studied
}
```

### Quiz Statistics
```javascript
{
  quizzesTaken: Number,        // Total quizzes completed
  correctAnswers: Number,      // Total correct answers
  totalQuestions: Number,      // Total questions answered
  // Accuracy = correctAnswers / totalQuestions * 100
}
```

### Topic Accuracy Tracking
```javascript
{
  topicAccuracy: Map<String, {
    correct: Number,
    total: Number,
    lastAttempt: Date
  }>
}
```

### Prestige System (Object)
```javascript
{
  prestige: {
    level: Number,             // Prestige level (0-10)
    totalXpEarned: Number,     // Lifetime XP (SHOULD track all XP ever)
    bonusMultiplier: Number,   // XP multiplier (1.0 to 1.5)
    prestigeHistory: [{
      level: Number,
      xpAtPrestige: Number,
      date: Date
    }]
  }
}
```

### Arena/Multiplayer Stats
```javascript
{
  arenaStats: {
    played: Number,
    wins: Number,
    podiums: Number,           // Top 3 finishes
    highestScore: Number
  }
}
```

### Daily Challenge Stats
```javascript
{
  dailyChallengeStats: {
    completed: Number,
    currentStreak: Number,
    longestStreak: Number,
    lastCompletedDate: Date,
    averageTime: Number
  }
}
```

### Other Tracking
```javascript
{
  longestStreak: Number,       // Longest streak ever achieved
  mentorSessions: Number,      // Tutor sessions count
  codeReviews: Number,         // Code reviews requested
  debugSessions: Number,       // Debug sessions count
  referrals: Number,           // Users referred
  shareCount: Number,          // Times shared
}
```

### Key Methods on User Model
```javascript
// Calculate XP needed to level up from current level
user.xpForNextLevel()  // Returns: Math.floor(100 * 1.5^(level-1))

// Add XP and handle level-ups (SUBTRACTS XP on level up!)
user.addXp(amount)     // Returns: { leveledUp, newLevel, levelsGained }

// Update activity streak
user.updateStreak()    // Returns: current streak value
```

## QuizSession Model (src/database/models/QuizSession.js)

Stores active quiz sessions to survive bot restarts.

```javascript
{
  sessionId: String,           // Unique session ID
  discordId: String,           // User taking quiz
  topic: String,               // Quiz topic
  difficulty: String,          // easy/medium/hard
  questions: [{
    question: String,
    options: [String],         // 4 options
    correctIndex: Number,      // 0-3
    explanation: String,
    conceptTested: String
  }],
  currentQuestion: Number,     // Current question index
  score: Number,               // Correct answers so far
  answers: [{                  // User's answers
    questionIndex: Number,
    selectedIndex: Number,
    correct: Boolean
  }],
  hintUsed: Boolean,          // Hint lifeline used
  fiftyUsed: Boolean,         // 50/50 lifeline used
  eliminatedOptions: [Number], // Options eliminated by 50/50
  status: String,             // active/completed/cancelled
  startedAt: Date,
  completedAt: Date
}
```

---

# 5. ALL 50 SLASH COMMANDS

## ðŸ“– Learning Commands
| Command | Description | Key Function |
|---------|-------------|--------------|
| `/learn` | Start an AI-generated lesson on any topic | Calls AI to generate lesson content |
| `/quiz` | Take an AI-generated quiz (1-10 questions) | Creates QuizSession, generates questions |
| `/quickquiz` | 60-second rapid-fire quiz | Timed quiz mode |
| `/explain` | Get AI explanation of any concept | Direct AI explanation |
| `/flashcard` | Practice with spaced-repetition flashcards | SRS algorithm |
| `/topics` | Browse available learning topics | Lists all topics |
| `/path` | Generate a personalized learning path | AI creates curriculum |
| `/project` | Project-based learning with steps | Guided projects |

## ðŸŽ® Gamification Commands
| Command | Description | Key Function |
|---------|-------------|--------------|
| `/daily` | Claim daily XP bonus | Awards XP, updates streak |
| `/profile` | View your learning stats | Displays user data |
| `/card` | View your trading card | Visual profile card |
| `/achievements` | View unlocked achievements | Lists achievements |
| `/leaderboard` | Global rankings | Sorts users by XP/level |
| `/streak` | View your streak status | Shows streak info |
| `/prestige` | Reset level for permanent bonuses | Prestige system |
| `/skills` | View your skill levels | Skill tracking |
| `/skilltree` | Interactive skill tree | Skill progression |

## ðŸ† Competitive Commands
| Command | Description | Key Function |
|---------|-------------|--------------|
| `/arena` | Real-time multiplayer quiz battles | Live PvP |
| `/challenge` | Challenge another user | 1v1 quiz |
| `/tournament` | Join community tournaments | Bracket system |
| `/teambattle` | Team vs team competitions | Team mode |
| `/weekly` | Weekly challenges | Time-limited |
| `/dailychallenge` | Daily coding challenge | Code challenges |
| `/speedrun` | Timed quiz speedruns | Speed mode |

## ðŸ“Š Progress Commands
| Command | Description | Key Function |
|---------|-------------|--------------|
| `/progress` | Detailed learning progress | Progress tracking |
| `/stats` | In-depth statistics | Detailed stats |
| `/heatmap` | Activity heatmap visualization | Calendar view |
| `/insights` | AI-powered learning insights | AI analysis |
| `/weakspots` | Identify weak areas | Topic analysis |
| `/certificate` | Generate learning certificates | PDF certificates |

## ðŸ¤– AI Features
| Command | Description | Key Function |
|---------|-------------|--------------|
| `/tutor` | Chat with AI tutor | Conversational AI |
| `/review` | AI code review | Code analysis |
| `/debug` | AI debugging help | Debug assistance |
| `/interview` | Mock interview practice | Interview prep |
| `/funfact` | Programming fun facts | Entertainment |

## ðŸ”§ Utility Commands
| Command | Description | Key Function |
|---------|-------------|--------------|
| `/help` | Main help hub | Navigation |
| `/ping` | Bot latency check | Health check |
| `/invite` | Bot invite link | Invite URL |
| `/about` | About MentorAI | Bot info |
| `/feedback` | Submit feedback | User feedback |
| `/setup` | Server configuration | Server setup |
| `/remind` | Set learning reminders | Notifications |
| `/theme` | Customize appearance | Theming |
| `/website` | Open website | Website link |

## ðŸ‘¤ Social Commands
| Command | Description | Key Function |
|---------|-------------|--------------|
| `/share` | Share achievements | Social sharing |
| `/referral` | Referral program | Invite rewards |
| `/studyparty` | Group study sessions | Multiplayer |
| `/event` | Community events | Events |

## ðŸ›¡ï¸ Admin Commands
| Command | Description | Key Function |
|---------|-------------|--------------|
| `/admin` | Admin panel (owner only) | Admin functions |
| `/run` | Execute code (sandboxed) | Code execution |

---

# 6. GAMIFICATION SYSTEM

## XP Rewards (src/services/gamificationService.js)

```javascript
export const XP_REWARDS = {
  QUIZ_CORRECT: 25,        // Per correct answer
  QUIZ_COMPLETE: 50,       // Completing any quiz
  QUIZ_PERFECT: 100,       // 100% score bonus
  LESSON_COMPLETE: 40,     // Completing a lesson
  DAILY_BONUS: 75,         // Daily claim base
  STREAK_BONUS: 15,        // Per day of streak (capped)
  FIRST_QUIZ: 100,         // First quiz ever
  FIRST_LESSON: 75,        // First lesson ever
  CHALLENGE_WIN: 150,      // Winning a challenge
  LEVEL_UP: 50             // Level up bonus
};
```

## Multipliers

### Difficulty Multipliers
```javascript
const difficultyMultiplier = {
  easy: 0.8,     // 80% of base XP
  medium: 1.0,   // 100% of base XP
  hard: 1.5      // 150% of base XP
};
```

### Streak Multipliers (DEFINED but NOT APPLIED - BUG!)
```javascript
export function getStreakMultiplier(streak) {
  if (streak >= 30) return 2.0;   // 2x XP
  if (streak >= 14) return 1.5;   // 1.5x XP
  if (streak >= 7) return 1.25;   // 1.25x XP
  if (streak >= 3) return 1.1;    // 1.1x XP
  return 1.0;
}
```

### Prestige Multipliers (DEFINED but NOT APPLIED - BUG!)
```javascript
const PRESTIGE_BONUSES = {
  1: { multiplier: 1.05 },  // +5% XP
  2: { multiplier: 1.10 },  // +10% XP
  // ...up to...
  10: { multiplier: 1.50 }  // +50% XP
};
```

---

# 7. AI INTEGRATION

## AI Provider Priority (src/ai/index.js)

```
Quiz Generation:
1. Gemini Flash 2.0 (fastest, if GEMINI_API_KEY set)
2. OpenAI o1 (advanced reasoning)
3. Fallback to curated questions from src/data/quizzes/

Lesson Generation:
1. OpenAI GPT-4o
2. Anthropic Claude (if OpenAI fails)
3. Fallback lesson template

Explanations:
1. OpenAI GPT-4o-mini (fast, cheap)
2. Fallback generic response
```

## AI Functions

### generateLesson(topic, difficulty, userContext)
- Creates personalized lesson with:
  - Title
  - Introduction
  - Content (3-4 paragraphs)
  - Key Points (4-5 bullets)
  - Code Example
  - Practice Challenge
  - Next Steps
  - Fun Fact

### generateQuiz(topic, numQuestions, difficulty, userContext)
- Creates quiz with:
  - Quiz Title
  - Questions array with 4 options each
  - Correct answer index
  - Explanations
  - Concepts tested
  - Encouragement message

### explainConcept(concept, context)
- Returns:
  - Simple explanation (ELI5)
  - Technical explanation
  - Real-world analogy
  - Code example
  - Common mistakes
  - Related concepts

### getStudyAdvice(userStats)
- Personalized advice based on:
  - Current level
  - Streak
  - Accuracy
  - Topics studied
  - Weak areas

---

# 8. XP & LEVELING SYSTEM

## The XP Formula

```javascript
// XP needed to level up FROM level N to level N+1
xpForLevel(level) = Math.floor(100 * Math.pow(1.5, level - 1))
```

### XP Requirements Table
| Level | XP to Next Level | Cumulative XP |
|-------|-----------------|---------------|
| 1     | 100             | 0             |
| 2     | 150             | 100           |
| 3     | 225             | 250           |
| 5     | 506             | 812           |
| 10    | 2,562           | 5,024         |
| 20    | 18,837          | 75,406        |
| 50    | 2,379,586       | 9,518,265     |

## How addXp Works

```javascript
user.addXp = function(amount) {
  this.xp += amount;
  
  // Level up loop
  while (this.xp >= this.xpForNextLevel()) {
    this.xp -= this.xpForNextLevel();  // SUBTRACT!
    this.level += 1;
  }
}
```

### CRITICAL UNDERSTANDING
- `user.xp` represents XP WITHIN the current level
- `user.xp` is NOT total lifetime XP
- On level up, XP is RESET (subtracted)
- Example: Level 1 with 150 XP â†’ Level 2 with 50 XP

---

# 9. STREAK SYSTEM

## Purpose
Reward users for consistent daily learning.

## Current Implementation (DUAL SYSTEM - BUG!)

### Streak Field 1: `user.streak`
- Updated by `user.updateStreak()` method
- Uses 24/48 hour rolling window logic
- Updated on any activity

### Streak Field 2: `user.dailyBonusStreak`
- Updated by `claimDailyBonus()` function
- Uses midnight-to-midnight UTC boundaries
- Only updated on /daily command

### Sync Behavior
```javascript
// In claimDailyBonus:
user.dailyBonusStreak = newStreak;
user.streak = newStreak;  // Overwrites!
```

## Streak Logic

### updateStreak() Method
```javascript
if (hoursSinceLastActive < 24) {
  // Same day, no change
}
else if (hoursSinceLastActive < 48) {
  streak += 1;  // Consecutive day
}
else {
  streak = 1;   // Streak broken
}
```

### claimDailyBonus() Logic
```javascript
if (lastClaim >= todayMidnight) {
  return "Already claimed";
}

if (lastClaim >= yesterdayMidnight) {
  newStreak = dailyBonusStreak + 1;  // Consecutive
} else {
  newStreak = 1;  // Streak reset
}
```

---

# 10. PRESTIGE SYSTEM

## Purpose
Allow high-level users to reset for permanent XP bonuses.

## Prestige Levels

| Level | Title | XP Requirement | Multiplier |
|-------|-------|----------------|------------|
| 1 | Bronze Scholar | 10,000 | 1.05x |
| 2 | Silver Scholar | 25,000 | 1.10x |
| 3 | Gold Scholar | 50,000 | 1.15x |
| 4 | Platinum Scholar | 100,000 | 1.20x |
| 5 | Diamond Scholar | 200,000 | 1.25x |
| 6 | Master Scholar | 400,000 | 1.30x |
| 7 | Grandmaster | 750,000 | 1.35x |
| 8 | Legendary | 1,500,000 | 1.40x |
| 9 | Mythic | 3,000,000 | 1.45x |
| 10 | Transcendent | 5,000,000 | 1.50x |

## How Prestige Works
1. User reaches requirement (total XP earned)
2. User uses `/prestige ascend`
3. User's level resets to 1
4. User's current XP resets to 0
5. User gains permanent XP multiplier
6. Total XP earned is preserved

## Storage
```javascript
user.prestige = {
  level: 3,                    // Current prestige level
  totalXpEarned: 75000,        // Lifetime XP (SHOULD be tracked)
  bonusMultiplier: 1.15,       // Current multiplier
  prestigeHistory: [...]       // History of prestiges
}
```

---

# 11. ACHIEVEMENT SYSTEM

## Achievement Categories
1. **Learning** - Lesson completion milestones
2. **Quiz** - Quiz completion and accuracy
3. **Streak** - Streak milestones
4. **Social** - Referrals, shares
5. **Competitive** - Arena wins, tournaments

## Example Achievements

```javascript
// Streak achievements
{ id: 'streak_3', name: 'Getting Started', requirement: 3 days, xp: 75 }
{ id: 'streak_7', name: 'Week Warrior', requirement: 7 days, xp: 200 }
{ id: 'streak_30', name: 'Monthly Master', requirement: 30 days, xp: 1000 }
{ id: 'streak_100', name: 'Century Streak', requirement: 100 days, xp: 5000 }

// Quiz achievements
{ id: 'quiz_perfect', name: 'Perfect Score', requirement: 100% on quiz, xp: 100 }
{ id: 'quizzes_10', name: 'Quiz Fan', requirement: 10 quizzes, xp: 200 }
{ id: 'quizzes_50', name: 'Quiz Master', requirement: 50 quizzes, xp: 500 }

// Level achievements
{ id: 'level_5', name: 'Rising Star', requirement: level 5, xp: 150 }
{ id: 'level_10', name: 'Shining Bright', requirement: level 10, xp: 300 }
{ id: 'level_25', name: 'Superstar', requirement: level 25, xp: 750 }
```

## Rarity System
- **Common** - Easy to get
- **Uncommon** - Moderate effort
- **Rare** - Significant achievement
- **Epic** - Major milestone
- **Legendary** - Extraordinary dedication

---

# 12. QUIZ SYSTEM

## Quiz Flow
```
1. User: /quiz topic:JavaScript questions:5 difficulty:medium
2. Bot: Creates QuizSession in MongoDB
3. Bot: Calls AI to generate 5 questions
4. Bot: Shows question 1 with A/B/C/D buttons
5. User: Clicks answer button
6. Bot: Records answer, shows result
7. Bot: Shows next question
8. Repeat until all questions answered
9. Bot: Shows final results with XP earned
```

## Lifelines
- **Hint** - Get a hint about the concept
- **50/50** - Eliminate 2 wrong answers
- **Skip** - Skip to next question (counts as wrong)

## Session Storage
- Primary: MongoDB QuizSession model
- Fallback: In-memory Map (if DB unavailable)
- TTL: 30 minutes of inactivity

## Rate Limiting
```javascript
const RATE_LIMIT_WINDOW = 60000;  // 1 minute
const MAX_AI_CALLS_PER_MINUTE = 5;
```

---

# 13. LEARNING SYSTEM

## Lesson Structure
```javascript
{
  title: "Understanding JavaScript Closures",
  introduction: "Hook explaining why this matters...",
  content: "Main lesson content (3-4 paragraphs)...",
  keyPoints: [
    "Closures capture variables from outer scope",
    "They enable private variables",
    "Common in callbacks and event handlers",
    "Memory considerations to be aware of"
  ],
  codeExample: {
    language: "javascript",
    code: "function createCounter() { ... }",
    explanation: "This demonstrates..."
  },
  practiceChallenge: {
    task: "Create a memoization function",
    hint: "Use an object to cache results"
  },
  nextSteps: "Learn about the module pattern...",
  funFact: "Closures were first described in 1964..."
}
```

## Topic Tracking
- Topics studied are stored in `user.topicsStudied[]`
- Used for recommendations and personalization
- Prevents repeated suggestions

---

# 14. WEB INTERFACE

## Endpoints

### Public Website (/)
- Landing page at https://mentorai.up.railway.app
- Trading card display with URL parameters
- Dashboard at /dashboard

### API Routes

#### Public (No Auth)
```
GET /api/public/profile/:discordId  - Get user profile
GET /health                          - Health check
```

#### Protected (Admin Auth)
```
GET /api/stats                       - Bot statistics
GET /api/users                       - List all users
POST /api/users/:id/ban              - Ban user
POST /api/users/:id/xp               - Give XP
POST /api/broadcast                  - Send announcement
```

## Real-Time Updates
- Socket.IO for live admin panel updates
- User changes broadcast to connected admins

---

# 15. DATA FLOW DIAGRAMS

## Quiz Command Flow
```
User sends /quiz topic:Python
         â†“
quiz.js execute()
         â†“
getOrCreateUser() â†’ MongoDB User
         â†“
user.updateStreak() â†’ Save
         â†“
createQuizSession() â†’ Check Rate Limit
         â†“
generateQuiz() â†’ Try Gemini â†’ Try OpenAI â†’ Fallback DB
         â†“
Save to QuizSession collection
         â†“
getCurrentQuestion()
         â†“
createQuizQuestionEmbed() â†’ Discord Embed
         â†“
User sees question with buttons
```

## Answer Submission Flow
```
User clicks Answer A button
         â†“
interactionCreate.js â†’ handleQuizButton()
         â†“
submitAnswer(userId, 0)
         â†“
QuizSession.findOne() â†’ Check answer
         â†“
Record in session.answers[]
         â†“
session.currentQuestion++
         â†“
If complete: completeQuiz()
  â†’ Calculate XP
  â†’ recordQuizCompletion()
  â†’ user.addXp()
  â†’ checkAchievements()
  â†’ user.save()
         â†“
Show result embed with next question
```

## Daily Bonus Flow
```
User sends /daily
         â†“
daily.js execute()
         â†“
getOrCreateUser()
         â†“
claimDailyBonus(user)
         â†“
Check lastDailyBonus vs today midnight
         â†“
If already claimed: Show "wait X hours"
         â†“
Calculate streak (consecutive days)
         â†“
Calculate XP: base + streak bonus + milestone
         â†“
user.addXp(totalXp)
         â†“
checkAchievements()
         â†“
user.save()
         â†“
Show reward embed with streak animation
```

---

# 16. KEY FILE LOCATIONS

## Core Files
| Purpose | File Path |
|---------|-----------|
| Bot Entry | `src/index.js` |
| User Model | `src/database/models/User.js` |
| XP/Level Formula | `src/config/brandSystem.js` (line 392) |
| Gamification | `src/services/gamificationService.js` |
| Quiz Service | `src/services/quizService.js` |
| AI Orchestrator | `src/ai/index.js` |

## Command Files
| Command | File Path |
|---------|-----------|
| /quiz | `src/bot/commands/quiz.js` |
| /daily | `src/bot/commands/daily.js` |
| /profile | `src/bot/commands/profile.js` |
| /card | `src/bot/commands/card.js` |
| /prestige | `src/bot/commands/prestige.js` |
| /leaderboard | `src/bot/commands/leaderboard.js` |
| /help | `src/bot/commands/help.js` |

## Configuration Files
| Purpose | File Path |
|---------|-----------|
| XP Rewards | `src/services/gamificationService.js` (lines 13-24) |
| Achievements | `src/config/achievements.js` |
| Quiz Config | `src/config/quizConfig.js` |
| Colors | `src/config/colors.js` |
| UI System | `src/config/brandSystem.js` |

## Handler Files
| Purpose | File Path |
|---------|-----------|
| All Interactions | `src/bot/events/interactionCreate.js` |
| Quiz Buttons | `src/handlers/quizInteractionHandler.js` |
| Help Buttons | `src/handlers/helpInteractionHandler.js` |

---

# ENVIRONMENT VARIABLES

```
DISCORD_TOKEN=        # Discord bot token (required)
DISCORD_CLIENT_ID=    # Discord application ID (required)
DATABASE_URL=         # MongoDB connection string (required)
OPENAI_API_KEY=       # OpenAI API key (for AI features)
GEMINI_API_KEY=       # Google Gemini API key (for fast quizzes)
ANTHROPIC_API_KEY=    # Claude API key (fallback)
PORT=                 # Web server port (default: 3000)
JWT_SECRET=           # Admin panel auth secret
ADMIN_USERNAME=       # Admin login username
ADMIN_PASSWORD=       # Admin login password
```

---

# SUMMARY FOR DEEPSEEK AI

## What MentorAI Does
1. Generates AI-powered programming lessons
2. Creates personalized quizzes with 4-option multiple choice
3. Tracks user progress with XP and levels
4. Motivates through streaks, achievements, and leaderboards
5. Offers competitive features like arena battles
6. Provides prestige system for advanced users

## Key Technical Points
1. User.xp = XP within current level, NOT total XP
2. XP is SUBTRACTED on level up (resets to remainder)
3. Two streak systems exist (should be one)
4. Prestige is stored as OBJECT with .level property
5. Multipliers are defined but NOT applied to XP
6. Leaderboard sorts by within-level XP (wrong)
7. Total XP (prestige.totalXpEarned) is not updated

## Primary Bug Categories
1. XP calculation inconsistencies
2. Streak system duplication
3. Type mismatches (prestige)
4. Unimplemented multipliers
5. Sorting by wrong fields

**See LOGIC_ERRORS_ANALYSIS.md for complete bug analysis**
**See LOGIC_ERRORS_FIXES.md for ready-to-apply code fixes**

---

**END OF BOT DOCUMENTATION**
